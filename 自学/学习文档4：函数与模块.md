# 学习文档4：函数与模块

## 1. 函数的定义与调用

### 1.1 函数的定义
函数是一段可重复使用的代码块，用于执行特定的任务。Python中使用`def`关键字定义函数。

**语法**：
```python
def 函数名(参数列表):
    """文档字符串"""
    函数体
    return 返回值
```

- **函数名**：遵循变量命名规则，应具有描述性
- **参数列表**：可选，用于接收传入函数的数据
- **文档字符串**：可选，用于描述函数的功能、参数和返回值
- **函数体**：函数执行的代码块
- **return语句**：可选，用于返回函数的结果

**示例**：
```python
def greet(name):
    """向指定的人打招呼"""
    print(f"Hello, {name}!")

# 调用函数
greet("Alice")  # 输出：Hello, Alice!
```

### 1.2 函数的调用
调用函数时，需要提供函数名和必要的参数。

```python
# 定义函数
def add(a, b):
    """计算两个数的和"""
    return a + b

# 调用函数，获取返回值
result = add(3, 5)
print(result)  # 输出：8
```

### 1.3 文档字符串
文档字符串是函数的说明文档，使用三个单引号或三个双引号包裹，位于函数定义的第一行。

可以使用`help()`函数查看函数的文档字符串。

```python
def add(a, b):
    """计算两个数的和
    
    参数：
        a: 第一个数
        b: 第二个数
    
    返回值：
        两个数的和
    """
    return a + b

# 查看文档字符串
help(add)
```

## 2. 函数的参数

### 2.1 位置参数
位置参数是最基本的参数类型，调用函数时必须按照定义的顺序提供参数。

```python
def greet(name, message):
    """向指定的人发送消息"""
    print(f"Hello, {name}! {message}")

# 调用函数，按照位置传递参数
greet("Alice", "How are you?")  # 输出：Hello, Alice! How are you?
```

### 2.2 关键字参数
关键字参数允许通过参数名来传递参数，不需要按照定义的顺序。

```python
def greet(name, message):
    """向指定的人发送消息"""
    print(f"Hello, {name}! {message}")

# 调用函数，使用关键字参数
greet(message="How are you?", name="Alice")  # 输出：Hello, Alice! How are you?
```

### 2.3 默认参数
默认参数允许在定义函数时为参数设置默认值，调用函数时如果不提供该参数，则使用默认值。

**注意**：默认参数必须放在位置参数之后。

```python
def greet(name, message="How are you?"):
    """向指定的人发送消息，默认消息为How are you?"""
    print(f"Hello, {name}! {message}")

# 调用函数，不提供默认参数
greet("Alice")  # 输出：Hello, Alice! How are you?

# 调用函数，提供默认参数
greet("Alice", "Nice to meet you!")  # 输出：Hello, Alice! Nice to meet you!
```

### 2.4 可变参数
可变参数允许函数接收任意数量的位置参数，使用`*`前缀表示。

**语法**：
```python
def 函数名(*args):
    函数体
```

- `*args`会将传入的多个位置参数打包成一个元组

**示例**：
```python
def add(*args):
    """计算任意数量的数的和"""
    total = 0
    for num in args:
        total += num
    return total

# 调用函数，传递任意数量的参数
print(add(1, 2, 3))  # 输出：6
print(add(1, 2, 3, 4, 5))  # 输出：15
```

### 2.5 关键字可变参数
关键字可变参数允许函数接收任意数量的关键字参数，使用`**`前缀表示。

**语法**：
```python
def 函数名(**kwargs):
    函数体
```

- `**kwargs`会将传入的多个关键字参数打包成一个字典

**示例**：
```python
def print_info(**kwargs):
    """打印任意数量的关键字参数"""
    for key, value in kwargs.items():
        print(f"{key}: {value}")

# 调用函数，传递任意数量的关键字参数
print_info(name="Alice", age=20, city="Beijing")
# 输出：
# name: Alice
# age: 20
# city: Beijing
```

### 2.6 参数组合
在Python中，参数可以按照以下顺序组合使用：
1. 位置参数
2. 默认参数
3. 可变参数
4. 关键字可变参数

**示例**：
```python
def func(a, b, c=0, *args, **kwargs):
    """参数组合示例"""
    print(f"a={a}, b={b}, c={c}")
    print(f"args={args}")
    print(f"kwargs={kwargs}")

# 调用函数
func(1, 2, 3, 4, 5, 6, x=7, y=8)
# 输出：
# a=1, b=2, c=3
# args=(4, 5, 6)
# kwargs={'x': 7, 'y': 8}
```

## 3. 函数的返回值

### 3.1 return语句
return语句用于返回函数的结果，可以返回任意类型的值。

```python
def add(a, b):
    """计算两个数的和"""
    return a + b

result = add(3, 5)
print(result)  # 输出：8
```

### 3.2 返回多个值
函数可以返回多个值，使用逗号分隔，返回的是一个元组。

```python
def calculate(a, b):
    """计算两个数的和、差、积、商"""
    add = a + b
    sub = a - b
    mul = a * b
    div = a / b
    return add, sub, mul, div

# 调用函数，获取多个返回值
result = calculate(10, 2)
print(result)  # 输出：(12, 8, 20, 5.0)
print(type(result))  # 输出：<class 'tuple'>

# 解包返回值
add, sub, mul, div = calculate(10, 2)
print(f"和：{add}, 差：{sub}, 积：{mul}, 商：{div}")  # 输出：和：12, 差：8, 积：20, 商：5.0
```

### 3.3 没有返回值的函数
如果函数没有return语句，或者return语句后面没有值，函数会返回`None`。

```python
def greet(name):
    """向指定的人打招呼"""
    print(f"Hello, {name}!")

result = greet("Alice")
print(result)  # 输出：None
```

## 4. 函数的高级特性

### 4.1 lambda函数
lambda函数是一种匿名函数，用于定义简单的函数。

**语法**：
```python
lambda 参数列表: 表达式
```

- lambda函数只能包含一个表达式
- lambda函数可以有任意数量的参数
- lambda函数的结果是表达式的计算结果

**示例**：
```python
# 定义lambda函数
square = lambda x: x**2
print(square(5))  # 输出：25

# 使用lambda函数作为参数
def apply_func(func, x):
    return func(x)

result = apply_func(lambda x: x**2, 5)
print(result)  # 输出：25

# 在列表排序中使用lambda函数
students = [
    {"name": "Alice", "age": 20},
    {"name": "Bob", "age": 18},
    {"name": "Charlie", "age": 22}
]
students.sort(key=lambda student: student["age"])
print(students)
# 输出：[{'name': 'Bob', 'age': 18}, {'name': 'Alice', 'age': 20}, {'name': 'Charlie', 'age': 22}]
```

### 4.2 递归函数
递归函数是指在函数内部调用自身的函数。

**示例**：
```python
def factorial(n):
    """计算n的阶乘"""
    if n == 0 or n == 1:
        return 1
    else:
        return n * factorial(n-1)

print(factorial(5))  # 输出：120
```

**注意事项**：
- 递归函数必须有一个基本情况（终止条件），否则会导致无限递归
- 递归函数的效率通常比迭代低，因为会产生额外的函数调用开销
- 递归深度有限制，默认最大递归深度为1000

### 4.3 闭包
闭包是指一个函数可以访问其外部作用域中的变量，即使外部函数已经执行完毕。

**示例**：
```python
def outer_func(x):
    """外部函数"""
    def inner_func(y):
        """内部函数"""
        return x + y  # 访问外部函数的变量x
    return inner_func  # 返回内部函数

# 创建闭包
add_5 = outer_func(5)
print(add_5(3))  # 输出：8
print(add_5(7))  # 输出：12

add_10 = outer_func(10)
print(add_10(3))  # 输出：13
```

**闭包的特点**：
- 内部函数可以访问外部函数的变量
- 外部函数的变量不会被垃圾回收，因为内部函数仍然引用它
- 闭包可以用于创建具有私有状态的函数

### 4.4 装饰器
装饰器是一种特殊的函数，用于修改其他函数的功能，而不需要修改函数本身的代码。

**语法**：
```python
def 装饰器函数(被装饰函数):
    def 包装函数(*args, **kwargs):
        # 装饰器逻辑
        result = 被装饰函数(*args, **kwargs)
        # 装饰器逻辑
        return result
    return 包装函数

@装饰器函数
def 被装饰函数():
    # 函数体
```

**示例**：
```python
def timer(func):
    """计算函数执行时间的装饰器"""
    import time
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        print(f"函数{func.__name__}执行时间：{end_time - start_time:.4f}秒")
        return result
    return wrapper

@timer
def factorial(n):
    """计算n的阶乘"""
    if n == 0 or n == 1:
        return 1
    else:
        return n * factorial(n-1)

factorial(10)  # 输出：函数factorial执行时间：0.0000秒
```

**装饰器的应用场景**：
- 日志记录
- 性能分析
- 权限验证
- 缓存
- 事务处理

## 5. 模块和包

### 5.1 模块的定义
模块是一个包含Python代码的文件，文件名即为模块名，后缀为`.py`。

模块可以包含：
- 函数
- 类
- 变量
- 可执行代码

### 5.2 模块的导入
使用`import`语句导入模块。

**语法**：
```python
# 导入整个模块
import 模块名

# 导入模块中的特定函数、类或变量
from 模块名 import 函数名/类名/变量名

# 导入模块中的所有内容
from 模块名 import *

# 导入模块并指定别名
import 模块名 as 别名

# 导入模块中的特定内容并指定别名
from 模块名 import 函数名/类名/变量名 as 别名
```

**示例**：
```python
# 导入整个模块
import math
print(math.pi)  # 输出：3.141592653589793
print(math.sqrt(16))  # 输出：4.0

# 导入模块中的特定函数
from math import pi, sqrt
print(pi)  # 输出：3.141592653589793
print(sqrt(16))  # 输出：4.0

# 导入模块并指定别名
import math as m
print(m.pi)  # 输出：3.141592653589793

# 导入模块中的所有内容
from math import *
print(pi)  # 输出：3.141592653589793
print(sqrt(16))  # 输出：4.0
```

### 5.3 标准库模块
Python提供了丰富的标准库模块，用于各种功能：

- **math**：数学运算
- **random**：随机数生成
- **datetime**：日期和时间处理
- **os**：操作系统交互
- **sys**：系统特定参数和函数
- **json**：JSON数据处理
- **re**：正则表达式
- **collections**：容器数据类型

**示例**：
```python
# 随机数生成
import random
print(random.random())  # 生成0到1之间的随机浮点数
print(random.randint(1, 10))  # 生成1到10之间的随机整数
print(random.choice([1, 2, 3, 4, 5]))  # 从列表中随机选择一个元素

# 日期和时间处理
import datetime
now = datetime.datetime.now()
print(now)  # 输出当前日期和时间
print(now.year)  # 输出当前年份
print(now.month)  # 输出当前月份
print(now.day)  # 输出当前日期

# 格式化日期和时间
print(now.strftime("%Y-%m-%d %H:%M:%S"))  # 输出：2023-05-20 14:30:00

# 操作系统交互
import os
print(os.getcwd())  # 输出当前工作目录
print(os.listdir())  # 列出当前目录中的文件和文件夹
```

### 5.4 包的定义
包是一个包含多个模块的目录，用于组织相关的模块。

包必须包含一个`__init__.py`文件，该文件可以是空文件，也可以包含包的初始化代码。

**包的结构**：
```
my_package/
    __init__.py
    module1.py
    module2.py
    sub_package/
        __init__.py
        module3.py
```

### 5.5 包的导入
使用`import`语句导入包中的模块。

**语法**：
```python
# 导入包中的模块
import 包名.模块名

# 导入包中的模块并指定别名
import 包名.模块名 as 别名

# 导入包中的特定内容
from 包名.模块名 import 函数名/类名/变量名

# 从包中导入模块
from 包名 import 模块名
```

**示例**：
```python
# 导入包中的模块
import my_package.module1
my_package.module1.func1()

# 导入包中的模块并指定别名
import my_package.module1 as m1
m1.func1()

# 导入包中的特定内容
from my_package.module1 import func1
func1()

# 从包中导入模块
from my_package import module1
module1.func1()
```

## 6. 函数的作用域

### 6.1 全局变量和局部变量
- **全局变量**：在函数外部定义的变量，可以在整个程序中访问
- **局部变量**：在函数内部定义的变量，只能在函数内部访问

**示例**：
```python
# 全局变量
x = 10

def func():
    # 局部变量
    y = 20
    print(f"函数内部：x={x}, y={y}")

func()  # 输出：函数内部：x=10, y=20
print(f"函数外部：x={x}")  # 输出：函数外部：x=10
# print(f"函数外部：y={y}")  # 报错：NameError: name 'y' is not defined
```

### 6.2 global关键字
如果在函数内部需要修改全局变量，需要使用`global`关键字声明。

**示例**：
```python
# 全局变量
x = 10

def func():
    global x  # 声明x是全局变量
    x = 20  # 修改全局变量
    print(f"函数内部：x={x}")

func()  # 输出：函数内部：x=20
print(f"函数外部：x={x}")  # 输出：函数外部：x=20
```

### 6.3 nonlocal关键字
如果在嵌套函数内部需要修改外部函数的变量，需要使用`nonlocal`关键字声明。

**示例**：
```python
def outer_func():
    x = 10  # 外部函数的变量
    
    def inner_func():
        nonlocal x  # 声明x是外部函数的变量
        x = 20  # 修改外部函数的变量
        print(f"内部函数：x={x}")
    
    inner_func()
    print(f"外部函数：x={x}")

outer_func()
# 输出：
# 内部函数：x=20
# 外部函数：x=20
```

## 7. 实践指导

### 7.1 函数设计原则
1. **单一职责原则**：一个函数只做一件事
2. **函数名要有描述性**：函数名应清晰地表达函数的功能
3. **参数要合理**：参数数量不宜过多，尽量使用默认参数
4. **返回值要明确**：函数应返回明确的结果
5. **添加文档字符串**：描述函数的功能、参数和返回值
6. **避免副作用**：函数应尽量不修改外部变量

### 7.2 模块设计原则
1. **模块名要有描述性**：模块名应清晰地表达模块的功能
2. **模块功能要单一**：一个模块应专注于一个特定的功能领域
3. **避免循环导入**：两个模块不应互相导入
4. **使用相对导入**：在包内部使用相对导入，提高模块的可移植性
5. **添加`__all__`变量**：明确指定模块导出的内容

### 7.3 常见错误和解决方法

#### 名称错误（NameError）
**错误示例**：
```python
def func():
    print(x)  # 引用未定义的变量x

func()  # 报错：NameError: name 'x' is not defined
```

**解决方法**：确保变量在使用前已经定义。

#### 类型错误（TypeError）
**错误示例**：
```python
def add(a, b):
    return a + b

add(1, "2")  # 报错：TypeError: unsupported operand type(s) for +: 'int' and 'str'
```

**解决方法**：确保传入函数的参数类型正确。

#### 递归错误（RecursionError）
**错误示例**：
```python
def factorial(n):
    return n * factorial(n-1)  # 没有终止条件，导致无限递归

factorial(5)  # 报错：RecursionError: maximum recursion depth exceeded
```

**解决方法**：为递归函数添加终止条件，确保递归深度不超过Python的限制。

#### 导入错误（ImportError）
**错误示例**：
```python
import non_existent_module  # 导入不存在的模块
# 报错：ImportError: No module named 'non_existent_module'
```

**解决方法**：确保模块名拼写正确，模块存在于Python的搜索路径中。

## 8. 总结

本章节介绍了Python的函数与模块，包括：
- 函数的定义与调用
- 函数的参数类型：位置参数、关键字参数、默认参数、可变参数、关键字可变参数
- 函数的返回值：单个返回值、多个返回值
- 函数的高级特性：lambda函数、递归函数、闭包、装饰器
- 模块和包的定义与导入
- 函数的作用域：全局变量、局部变量、global关键字、nonlocal关键字
- 实践指导：函数设计原则、模块设计原则、常见错误和解决方法

通过学习这些内容，你已经掌握了Python函数和模块的核心概念，可以编写更加模块化、可复用的代码。接下来，我们将学习Python的文件操作，进一步提升你的编程能力。